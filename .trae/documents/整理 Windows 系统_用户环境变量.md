## 目标
- 盘点并备份当前“系统环境变量”和“用户环境变量”
- 明确哪些变量应放系统、哪些应放用户，避免互相污染
- 重点清理 PATH：去重、删无效目录、规范顺序，解决“环境变量过大/2047 字符”问题

## 现状诊断（基于你的截图）
- 弹窗“此环境变量太大…最长 2047 个字符”通常出现在：使用旧式编辑器或某些界面在写入变量时触发 2047 限制（常见于 PATH 被堆得很长或包含重复/无效项）。

## 执行步骤
### 1) 备份（可回滚）
- 导出注册表：
  - 机器级：HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment
  - 用户级：HKCU\\Environment
- 额外文本备份：导出当前变量清单（系统/用户各一份）和当前合并后的 PATH。

### 2) 盘点与分类（系统 vs 用户）
- 规则：
  - **系统变量**：所有用户/服务都需要；或安装在 Program Files 并面向全局；如系统级工具、驱动/服务依赖路径。
  - **用户变量**：仅当前用户使用的开发工具链、个人配置、实验性路径；如 npm/pip/cargo 的 user bin、个人代理/临时配置等。
- 特殊规则：同名变量一般“用户覆盖系统”；PATH 会合并（通常用户项更靠前以获得优先级）。

### 3) PATH 清理策略（核心）
- 处理原则：
  - 去重（不区分大小写，统一末尾反斜杠）
  - 删除不存在目录/已卸载软件残留
  - 规范化（去掉多余引号、空项、`.`、重复分号）
  - 调整顺序：
    - Windows/System32 等系统关键项保留且靠前
    - 用户工具链（如 %USERPROFILE%\\.cargo\\bin、Python user scripts、npm global bin）放用户 PATH
    - 仅对所有用户生效的工具放系统 PATH
- 若 PATH 仍过长：
  - 用“变量引用”缩短：创建如 DEV_TOOLS=C:\\Tools，然后 PATH 里用 %DEV_TOOLS%\\bin
  - 统一安装目录并用更短路径（如 C:\\Tools\\…）替换深层目录
  - 尽量避免把多版本工具链都塞进 PATH（保留一个入口，其他用版本管理器/脚本切换）

### 4) 解决 2047 限制的落地方式
- 优先使用 Windows 10/11 的“PATH 分项编辑器”修改 PATH（通常不会受 2047 影响）。
- 若仍触发限制：使用 PowerShell/注册表写入方式更新（写入 REG_EXPAND_SZ/REG_SZ），并确保可回滚（用第 1 步备份恢复）。

### 5) 验证
- 新开一个 PowerShell/CMD：
  - 检查变量是否生效（系统/用户分别查看）
  - 逐个验证关键命令（如 git/python/node/java/cargo 等）是否能找到
  - 检查 PATH 中是否还包含不存在目录

## 交付物（我将提供）
- 一份“系统变量/用户变量”的推荐清单与放置原则（按常见开发工具链与系统必需项分类）
- 一个只读盘点脚本（生成报告：变量差异、PATH 统计、无效项、重复项）
- 一个可选的“生成清理后 PATH 文本”的脚本（默认不直接写入，先预览再应用）

## 需要你提供的信息（我会按最合理默认继续，不阻塞）
- 你主要用哪些工具链（例如：Node/Python/Java/Rust/Go/VS Build Tools）
- 你现在 PATH 大概多长、是否有多个版本并存（我会通过盘点脚本自动判断）